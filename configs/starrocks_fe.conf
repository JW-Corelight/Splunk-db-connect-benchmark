# StarRocks Frontend Configuration - M3 Optimized
# Purpose: Configure FE with conservative settings for Rosetta 2
# Last Updated: December 7, 2024

# ===========================================
# System Settings
# ===========================================
sys_log_level = WARN
LOG_DIR = ${STARROCKS_HOME}/log
DATE = `date +%Y%m%d-%H%M%S`
JAVA_OPTS_FOR_JDK_9 = "-Xms2048m -Xmx2048m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:+PrintGCDateStamps -XX:+PrintGCDetails -Xloggc:${LOG_DIR}/fe.gc.log.$DATE"

# ===========================================
# Metadata Storage
# ===========================================
meta_dir = ${STARROCKS_HOME}/meta
sys_log_dir = ${STARROCKS_HOME}/log
audit_log_dir = ${STARROCKS_HOME}/log

# ===========================================
# Network Configuration
# ===========================================
priority_networks = 172.28.0.0/16
rpc_port = 9020
query_port = 9030
edit_log_port = 9010
http_port = 8030

# ===========================================
# Memory Settings (Conservative for Rosetta)
# ===========================================
JAVA_OPTS = "-Xmx2048m -XX:+UseG1GC -XX:MaxGCPauseMillis=200"

# Query cache (2GB)
query_cache_size = 2147483648
qe_max_connection = 1024

# ===========================================
# Query Execution Settings
# ===========================================
max_query_retry_time = 3
max_running_rollup_job_num_per_table = 1
max_planner_scalar_rewrite_num = 100000

# Enable query queue
enable_query_queue_select = true
enable_query_queue_statistic = true
enable_query_queue_load = true

# ===========================================
# Load Settings
# ===========================================
max_load_timeout_second = 259200
max_stream_load_timeout_second = 259200
stream_load_default_timeout_second = 600

# ===========================================
# Tablet Configuration
# ===========================================
tablet_create_timeout_second = 10
max_create_table_timeout_second = 600
max_tablet_num_per_shard = 1024

# ===========================================
# Replication (Single Node)
# ===========================================
default_replication_num = 1

# ===========================================
# Storage Configuration
# ===========================================
storage_cooldown_second = 2592000
check_consistency_default_timeout_second = 600

# ===========================================
# Statistics
# ===========================================
enable_statistic_collect = true
statistic_collect_interval_sec = 300

# ===========================================
# Heartbeat
# ===========================================
heartbeat_timeout_second = 30
heartbeat_retry_times = 3

# ===========================================
# Thrift Server
# ===========================================
thrift_server_max_worker_threads = 4096
thrift_backlog_num = 1024

# ===========================================
# HTTP Settings
# ===========================================
http_backlog_num = 1024
http_max_line_length = 4096
http_max_header_size = 8192
enable_http_server_v2 = true

# ===========================================
# Logging
# ===========================================
sys_log_verbose_modules = org
audit_log_roll_num = 90
audit_log_modules = slow_query, query, load
qe_slow_log_ms = 5000
