# Trino Configuration - M3 Optimized
# Purpose: Coordinator-only mode for Iceberg table creation and management
# Architecture: Single-node deployment (coordinator includes worker functionality)
# Last Updated: December 8, 2024

# === Node Configuration ===
coordinator=true
node-scheduler.include-coordinator=true
node.environment=production
node.id=trino-coordinator-m3
node.data-dir=/data/trino

# === HTTP Server Configuration ===
http-server.http.port=8080
http-server.authentication.type=NONE

# === Discovery Configuration ===
discovery.uri=http://localhost:8080

# === Memory Configuration (M3 Optimized) ===
# Total available: 8GB allocated to container
# Reserve ~2GB for JVM overhead, ~6GB for query processing
query.max-memory=4GB
query.max-memory-per-node=2GB
query.max-total-memory-per-node=3GB
memory.heap-headroom-per-node=2GB

# === Query Configuration ===
query.max-execution-time=30m
query.max-run-time=30m
query.max-planning-time=10m

# === Exchange Configuration ===
exchange.max-buffer-size=32MB
sink.max-buffer-size=32MB

# === Task Configuration ===
# M3 has 8-12 cores depending on model
# Allocate 4 cores for query processing
task.concurrency=4
task.max-worker-threads=4
task.min-drivers=4

# === Spill Configuration ===
# Enable disk spilling for large queries
experimental.spiller-spill-path=/tmp/trino-spill
experimental.spill-enabled=true
experimental.max-spill-per-node=10GB

# === Optimizer Configuration ===
optimizer.dictionary-aggregation=true
optimizer.optimize-hash-generation=true
optimizer.optimize-metadata-queries=true
optimizer.push-aggregation-through-outer-join=true
optimizer.push-table-write-through-union=true

# === Performance Tuning ===
# Reduce memory pressure on M3
query.max-stage-count=100
query.max-hash-partition-count=100

# === Logging ===
# Set to DEBUG for troubleshooting, INFO for production
log.path=/data/trino/var/log/server.log
log.max-size=100MB
log.max-history=30
